---
layout: "post"
title: "「BUAA-OS」磁盘"
subtitle: "理论课"
author: "WassuhJ"
date: 2022-5-17

tags: ["操作系统", "北航"]
lang: zh
catalog: true
header-image: ""
header-style: text
katex: true
---

### 结构

#### 物理地址

盘面：一个盘片可能会有两个盘面

磁道：磁盘的盘面被划分成的“圈”

磁头：每个盘面对应一个磁头，所有磁头连在同一个磁臂上，“共进退”

柱面：所有盘面中相对位置相同的磁道组成柱面

* 可以用 $(柱面号,盘面号,扇区号)$ 来定位任意一个“磁盘块”
  * 一个磁道被划分成一个个扇区，每个扇区即“磁盘块”
  * **各个扇区存放的数据量相同**

* 读取过程
  * 根据柱面号移动磁臂，让磁头指向指定柱面；
  * 激活指定盘面对应的磁头；
  * 磁盘旋转的过程中，指定的扇区会从磁头下面划过，这样就完成了对指定扇区的读/写



#### 分类

* 根据磁头是否可移动
  * 活动头磁盘：磁头可以移动
  * 固定头磁盘：磁头不可以移动，每个磁道都有一个磁头

* 根据盘面是否可更换：固定盘磁盘/可换盘磁盘



### 调度算法

#### 一次磁盘读/写操作用时

* 寻道时间 $T_s$ ：在读写数据前，把磁头移动到指定磁道用时
  * 启动磁头臂时间 $s$ + 移动磁头时间（跨越磁道数 $n$ * 跨越一个磁道用时 $m$）
* 延迟时间 $T_R$：通过旋转磁盘，使磁头定位到目标扇区所需要的时间
  * 设磁盘转速为 $r$ ，则平均所需延迟时间 $T_R=\dfrac{1}{2}\times \dfrac{1}{r}$

* 传输时间 $T_t$：从磁盘读出或向磁盘写入数据所经历的时间
  * 设磁盘转速为 $r$，此次读写的字节数为 $b$，每个磁道上字节数均为 $N$，则：$T_t=\dfrac{1}{r}\times \dfrac{b}{N}$

总的平均存取时间：$T_a=T_s+T_R+T_t$，**转速**，**调度算法影响的是寻道时间**



#### 算法

* 先来先服务（FCFS）
  * 优点：公平，请求集中时性能尚可
  * 缺点：大量进程竞争使用磁盘，请求访问的磁道很分散性能上很差，寻道时间长

* 最短寻找时间优先（SSJF）
  * 优点：性能好；缺点：可能产生饥饿

* 扫描算法（SCAN）：到最外侧才会回头，不是 look
  * 优点：性能较好，不会产生饥饿
  * 缺点：非 look 的多余移动；对各个位置相应频率不平均，外侧访问频率更高

* LOOK 算法：这可太熟了，边移动边观察

* 循环扫描算法（C-SCAN)：直接快速返回起始端
  * 优点：响应平均
  * 缺点：非 look 的多余移动；和 SCAN 相比，平均寻道时间更长

* C-LOOK：C-SCAN + LOOK，到最靠外侧的请求就返回起始端



### 减少延迟时间的方法

原因：

* 连续读取扇区时，磁头读取一个扇区的内容后有一小段时间处理，因此无法连续不断地读入下一个扇区；错过之后只能等下一圈；

* **逻辑上相邻的扇区在物理上也相邻，则“延迟时间”变长**
  * 方法：交替编号；错位命名



#### 磁盘地质结构的设计

为什么物理地址中柱面号在前？

答：读取地址连续的磁盘块时，采用推荐的地址结构可以减少磁头移动消耗的时间



### 磁盘的管理

#### 磁盘初始化

1. 低级格式化（物理格式化），将磁盘的各个磁道划分为扇区
2. 将磁盘分区，每个分区由若干柱面组成
3. 逻辑格式化，创建文件系统



#### 引导块

* 计算机开机时需要进行一系列初始化的工作，这些初始化工作室通过执行**初始化程序（自举程序）**完成的
* ROM中只存放很小的自举装入程序，完整的放在磁盘的引导块上，位于磁盘的固定位置
* 开机时计算机先运行“自举装入程序”，通过执行改程序就可以找到引导块，并将完整的“自举程序”读入内存，完成初始化
  * 拥有引导块（启动分区）的磁盘称为启动磁盘或系统磁盘（C:盘）



#### 坏块的管理

坏块：硬件故障，OS不能修复，需标记出来

* 逻辑格式化时对整个磁盘坏块检查，表明坏扇区（FAT表）：对 OS 不透明

* 扇区备用：对 OS 透明

  * 磁盘控制器会维护一个坏块链表
  * 在磁盘出厂前进行低级格式化是就将坏块链初始化

  * 会保留一些“备用扇区”，用于替换坏块